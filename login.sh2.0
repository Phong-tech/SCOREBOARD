#!/bin/bash

USER_FILE="/home/phong/idg1100-exam-main/login.txt"

# Register a new user
function register_user() {
    read -p "Enter username: " username
    read -sp "Enter password: " password
    echo
    # Use awk to check if the username exists
    if awk -F: -v user="$username" '$1 == user {exit 0} END {exit 1}' "$USER_FILE"; then
        echo "Username already exists. Please log in."
        return 1
    fi
    # Add the new user
    echo "$username:$password" >> "$USER_FILE"
    echo "Registration successful!"
    return 0
}

# Log in an existing user
function login_user() {
    read -p "Enter username: " username
    read -sp "Enter password: " password
    echo
    # Use awk to validate credentials
    if awk -F: -v user="$username" -v pass="$password" '$1 == user && $2 == pass {exit 0} END {exit 1}' "$USER_FILE"; then
        echo "Login successful!"
        echo "$username" > /tmp/current_user.txt

        # Redirect to game.html (for web environment)
        echo "Content-type: text/html"
        echo ""
        echo "<html><head><meta http-equiv='refresh' content='0;url=game.html'></head></html>"
        return 0
    else
        echo "Invalid credentials."
        return 1
    fi
}

# Main function
echo "1. Register"
echo "2. Login"
read -p "Select an option: " option
if [[ "$option" == "1" ]]; then
    while ! register_user; do :; done
elif [[ "$option" == "2" ]]; then
    while ! login_user; do :; done
else
    echo "Invalid option."
fi


